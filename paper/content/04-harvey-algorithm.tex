\chapter{Harvey's algorithm}

TODO: Introduction.

\begin{enumerate}
    \item Brief of the idea;
    \item Pseudo-algorithm;
    \item Corretude;
\end{enumerate}

The main bottleneck in the previous algorithm was the need to update the entire inverse matrix at each step. 
Harvey's algorithm addresses this limitation by employing a divide-and-conquer strategy combined with lazy updates. 
After each recursive step, only the necessary portions of the inverse matrix are updated.
As a result, Harvey's algorithm has a time complexity of \(O(n^\omega)\).

\section{Algorithm}

The algorithm will maintain two matrices: \(T\), a Tutte Matrix of the graph, and \(N\), which is initialized as \(T^{-1}\).
It relies on two recursive functions: \(\SC{DeleteEdgesCrossing}\) and \(\SC{DeleteEdgesWithin}\). 

\subsubsection*{\(\SC{DeleteEdgesCrossing}\)}

$\SC{DeleteEdgesCrossing}(R, S)$: receives two disjoint sets of vertices \(R\) and \(S\) and 
deletes non-essential\footnote{Essential and non-essential edges will be defined in the previous chapter.} 
edges that connect a vertex in \(R\) to a vertex in \(S\).
The following invariant must be preserved:
\begin{itemize}
    \item \(\SC{DeleteEdgesCrossing}(R, S)\): intially has \(N_{R \cup S, R \cup S} = {T^{-1}}_{R \cup S, R \cup S}\) and this property is restored after each call 
    of \(\SC{DeleteEdgesCrossing}(R_i, S_j)\).
\end{itemize}
To maintain this invariant the following updates are done. 

TODO: explicit that in both update theorems \(T\) is a Tutte Matrix.

\begin{theorem}[Update 1]
    Given two disjoint sets \(R\) and \(S\) such that \(|R| = |S| = 1\).
    Let \(N \coloneqq T^{-1}\), \(r \in R\) and \(s \in S\).
    If \(rs\) is non-essential, let \(T'\) be the Tutte matrix of \(G\) without edge \(rs\), then one has
    \[
        T'^{-1}_{r, s} = N_{r, s} (1 - T_{r, s} N_{r, s}) / (1 + T_{r, s} N_{r, s})
    \]
    and
    \[
        T'^{-1}_{s, r} = N_{s, r} (1 - T_{s, r} N_{s, r}) / (1 + T_{s, r} N_{s, r}) = -T'^{-1}_{r, s}.
    \]
\end{theorem}

\begin{proof}
    TODO
\end{proof}

\begin{theorem}[Update 2]
    Given two disjoint sets \(R\) and \(S\). Let \(T'\) be \(T\) after removing some (possibly zero) edges from \(G\) that connects vertices from \(R_i\) to vertices in \(S_j\).
    Then, let \(N := T^{-1}\) and \(\Delta := T - T'\), one has:
    \[
        T'^{-1}_{R \cup S, R \cup S} = N_{R \cup S, R \cup S} - N_{R \cup S, R_i \cup S_j}(I + \Delta N_{R_i \cup S_j, R_i \cup S_j})^{-1} \Delta N_{R_i \cup S_j, R \cup S}.
    \]
\end{theorem}

\begin{proof}
    TODO
\end{proof}

\begin{programruledcaption}{Harvey's algorithm: DeleteEdgesCrossing}
    \begin{lstlisting}[
      language={pseudocode},
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        function DeleteEdgesCrossing(R, S)
            if $|R| = 0$ or $|S| = 0$ then return $\emptyset$ // There are no edges

            if $|R| = 1$ and $|S| = 1$ then // There is at most \textbf{one} edge
                r, s := vertex in R, vertex in S
                if $T_{r, s} \neq 0$ \textbf{ and } $T_{r, s} \neq -1 / N_{r, s}$ then // This edge can be removed
                    $N_{r, s}$ := $N_{r, s} (1 - T_{r, s} N_{r, s}) / (1 + T_{r, s} N_{r, s})$ // Update 1
                    $N_{s, r}$ := $-N_{r, s}$
                    $T_{rs}, T_{sr}$ := 0, 0 // Edge has been removed
                end
                return
            end

            $RS$ := $R \cup S$
            $R_1, R_2$ := divide R in two 
            $S_1, S_2$ := divide S in two
            for i \textbf{in} {1, 2} do
                for j \textbf{in} {1, 2} do
                    $T', N'$ := $T, N$
                    $\SC{DeleteEdgesCrossing}(R_i, S_j)$
                    $\Delta$ := $T_{R_i \cup S_j, R_i \cup S_j} - {T'}_{R_i \cup S_j, R_i \cup S_j}$
                    $N_{RS, RS}$ := ${N'}_{RS, RS} - {N'}_{RS, R_i \cup S_j} (I + \Delta {N'}_{R_i \cup S_j, R_i \cup S_j})^{-1} \Delta {N'}_{R_i \cup S_j, RS}$ // Update 2
                end
            end
        end
    \end{lstlisting}
\end{programruledcaption}

\begin{programruledcaption}{Harvey's algorithm: DeleteEdgesWithin}
    \begin{lstlisting}[
      language={pseudocode},
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        function DeleteEdgesWithin(V)
            if |V| = 1 return

            S_1, S_2 := divide S in the middle
            for i \textbf{in} {1, 2} do
                $T', N'$ := $T, N$ // Save current T and N states
                $\SC{DeleteEdgesWithin}(S_i)$
                $\Delta$ := $T_{S_i, S_i} - {T'}_{S_i, S_i}$
                $N_{S, S}$ := $N' - {N'}_{S, S_i}(I + \Delta {N'}_{S, S})^{-1} \Delta {N'}_{S_i, S}$ // Update 3
            end
            $\SC{DeleteEdgesCrossing}(S_1, S_2)$
        end
    \end{lstlisting}
\end{programruledcaption}


\begin{programruledcaption}{Harvey's algorithm: Perfect Matching}
    \begin{lstlisting}[
      language={pseudocode},
      style=pseudocode,
      style=wider,
      functions={},
      specialidentifiers={},
    ]
        function PerfectMatching(G)
            T := $\SC{TutteMatrix}(G)$
            if T \textbf{ is singular} then return $\emptyset$ // The graph has no perfect matching
            N := $T^{-1}$
            $\SC{DeleteEdgesWithin(V)}$
            M := $\emptyset$
            for uv \textbf{in} E(G) do
                if $T_{uv} \neq 0$ then M := $M \cup \{uv\}$
            end
            return M
        end
    \end{lstlisting}
\end{programruledcaption}